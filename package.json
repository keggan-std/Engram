{
  "name": "engram-mcp-server",
  "version": "1.8.1",
  "description": "Engram ‚Äî Persistent Memory Cortex for AI coding agents. Gives agents session continuity, change tracking, decision logging, and project intelligence across sessions.",
  "type": "module",
  "main": "dist/index.js",
  "bin": {
    "engram": "dist/index.js",
    "engram-mcp-server": "dist/index.js"
  },
  "files": [
    "dist/"
  ],
  "repository": {
    "type": "git",
    "url": "git+https://github.com/keggan-std/Engram.git"
  },
  "releaseNotes": "# v1.8.0 ‚Äî Cross-Instance Infrastructure & Sensitive Data Protection\n\n**Released:** v1.8.0\n\n## Overview\n\nv1.8.0 introduces **cross-instance infrastructure** ‚Äî the foundation for multi-project memory federation. Engram instances on the same machine can now discover each other, query each other's memory (opt-in), and protect sensitive data behind a human-approval gate. Zero breaking changes.\n\n### New capabilities\n\n| Feature | Action |\n|---------|--------|\n| Discover all Engram instances on this machine | `discover_instances` |\n| Query decisions/conventions from another project | `query_instance` |\n| Search across all sharing projects at once | `search_all_instances` |\n| Import records from another instance | `import_from_instance` |\n| Lock sensitive records from cross-instance queries | `mark_sensitive` |\n| Request + approve access to locked data | `request_access` / `approve_access` |\n\n---\n\n## What's New\n\n### Instance Identity (Migration v17)\n\nEvery database now gets a **stable, unique identity** on first initialization after upgrading to v1.8.0. No action required ‚Äî identities are generated automatically.\n\n| Config Key | Value |\n|------------|-------|\n| `instance_id` | UUID v4, immutable |\n| `instance_label` | Auto-generated (e.g. `vscode-Engram`) |\n| `instance_created_at` | ISO timestamp, immutable |\n| `machine_id` | OS hardware fingerprint |\n| `sharing_mode` | `none` \\| `read` \\| `full` ‚Äî default: `none` |\n| `sharing_types` | JSON array ‚Äî default: `[\"decisions\",\"conventions\"]` |\n\n### Machine-Wide Instance Registry\n\nAll running instances register in `~/.engram/instances.json`, updated by a 60-second heartbeat. Stale entries (>5 min) and pruned entries (>7 days) are handled automatically. Writes are atomic (temp + rename).\n\n### Cross-Instance Queries (7 new admin actions)\n\nForeign databases are opened with `{ readonly: true }` ‚Äî writes are architecturally impossible. A 5-minute DB handle cache with max 10 slots avoids repeated open/close overhead.\n\n- `discover_instances` ‚Äî list all instances with status, sharing, and stats\n- `get_instance_info` ‚Äî identity and sharing config for this instance\n- `set_sharing` ‚Äî configure `sharing_mode` and `sharing_types`\n- `query_instance` ‚Äî read decisions/conventions/file_notes/tasks/sessions/changes from another instance\n- `search_all_instances` ‚Äî FTS5 federated search across all sharing instances\n- `import_from_instance` ‚Äî copy records with provenance tagging (requires `full` sharing)\n- `set_instance_label` ‚Äî rename this instance\n\n### Sensitive Data Protection (7 new admin actions)\n\nLocked records are **absent from all cross-instance results** ‚Äî not masked, not redacted, simply not returned. Access can be delegated via a human-gated approval workflow.\n\n- `mark_sensitive` ‚Äî lock specific record IDs by type\n- `unmark_sensitive` ‚Äî remove locks\n- `list_sensitive` ‚Äî view all locked records\n- `request_access` ‚Äî a remote instance files an access request (status: pending)\n- `approve_access` ‚Äî human approves a pending request\n- `deny_access` ‚Äî human denies a pending request\n- `list_access_requests` ‚Äî view requests with optional status filter\n\n---\n\n## Upgrade Notes\n\n- **No action needed on upgrade.** Migration v17 runs automatically on first startup and writes instance identity to the `config` table.\n- **Sharing is off by default.** `sharing_mode: \"none\"` means this instance is completely invisible to cross-instance queries until you explicitly run `set_sharing`.\n- **Installs on all IDEs** pick up the same registry file (`~/.engram/instances.json`), so instances across VS Code, Cursor, and Claude Desktop all see each other.\n\n---\n\n## Stats\n\n- **196 tests** total (77 new for this release)\n- **14 new admin actions** (7 cross-instance + 7 sensitive data)\n- **3 new services** (InstanceRegistryService, CrossInstanceService, SensitiveDataService)\n- **Migration v17** ‚Äî adds `sensitive_access_requests` table\n- **3,161 lines added** across 21 files\n\n---\n\n# v1.7.2 ‚Äî Hotfix: Enum Validation, Targeted Broadcasts & API Correctness\n\n**Released:** v1.7.2\n\n## Overview\n\nv1.7.2 is a hotfix release addressing **20 bugs** discovered during a systematic functional audit of the v1.7.0 tool surface. No new features ‚Äî only correctness and reliability fixes. Zero breaking changes.\n\n| ID          | Area            | Fix                                                               | Commit    |\n| ----------- | --------------- | ----------------------------------------------------------------- | --------- |\n| ISS-001‚Äì015 | API correctness | Various: report, backup, tasks, events, session error messages    | `8dd7bce` |\n| ISS-007     | Universal Mode  | `discover` action used full-string includes instead of BM25       | `061b790` |\n| ISS-016     | `what_changed`  | `\"session_start\"` used as literal SQL string (always 0 results)   | `061b790` |\n| ISS-017     | `create_task`   | `priority` accepted any string ‚Äî no enum validation               | `c89edb1` |\n| ISS-018     | `broadcast`     | `target_agent` column missing; all agents received all broadcasts | `b0efaf2` |\n| ISS-019     | `record_change` | `change_type` + `impact_scope` accepted any string                | `c89edb1` |\n| ISS-020     | Universal Mode  | `set_file_notes` crashed when `dependencies` was a JSON string    | `13af958` |\n\n---\n\n## What's Fixed\n\n### üîí Enum Validation ‚Äî `change_type`, `impact_scope`, `priority`\n\n`record_change`, `create_task`, and related actions now reject invalid values with a clear Zod validation error.\n\n**Valid values:**\n\n- `change_type`: `created | modified | deleted | refactored | renamed | moved | config_changed`\n- `impact_scope`: `local | module | cross_module | global`\n- `priority`: `critical | high | medium | low`\n\n### üì° Directed Broadcasts ‚Äî `target_agent` Column + Query Filter\n\nThe `broadcasts` table now has a `target_agent TEXT` column (migration v16). The `broadcast` INSERT stores it; the `agent_sync` SELECT filters `WHERE target_agent IS NULL OR target_agent = ?`. Directed messages are now correctly scoped to their intended recipient.\n\n### ‚è±Ô∏è `what_changed { since: \"session_start\" }`\n\nThe `\"session_start\"` sentinel is now resolved to the session's `started_at` ISO timestamp before the SQL query executes.\n\n### üß© Universal Mode ‚Äî Array Coercion Bypass Fixed\n\n`HandlerCapturer` (the duck-typed SDK stub used in Universal Mode) bypasses Zod `.transform()` preprocessing. `set_file_notes` with `dependencies` passed as a JSON string now works correctly ‚Äî a `parseDepsField()` helper in `file-notes.repo.ts` handles both `string[]` and raw JSON string inputs.\n\n### ‚úÖ API Correctness (ISS-001 ‚Äì ISS-015)\n\n- `generate_report` returns a full project knowledge summary\n- `get_global_knowledge` returns correct data shape\n- `backup` no longer throws `ENOENT`\n- `get_tasks { status: \"all\" }` returns all tasks regardless of status\n- `acknowledge_event { approved: false }` snoozes the event (was a no-op)\n- `config { op: \"get\", key: X }` returns only that key's value (was all config)\n- `record_milestone` version prefix no longer doubled (`v1.7.1` not `vv1.7.1`)\n- `dump` no longer creates a spurious `file_path: \"dump\"` change record\n- `NoActiveSessionError` message uses the correct v1.7 syntax\n- `checkpoint { progress: string }` accepts plain strings in `progress`\n- `update_task { id: N }` uses `id` (not `task_id`)\n\n---",
  "scripts": {
    "build": "tsc",
    "prepack": "node scripts/inject-release-notes.js && npm run clean && npm run build",
    "test": "vitest run",
    "test:coverage": "vitest run --coverage",
    "test:watch": "vitest",
    "start": "node dist/index.js",
    "dev": "tsc --watch",
    "clean": "node -e \"const {rmSync,existsSync}=require('fs');if(existsSync('dist'))rmSync('dist',{recursive:true,force:true})\"",
    "install-hooks": "node dist/scripts/install-hooks.js",
    "install-mcp": "node scripts/install-mcp.js",
    "install-mcp:list": "node scripts/install-mcp.js --list",
    "inspect": "npx @modelcontextprotocol/inspector node dist/index.js"
  },
  "keywords": [
    "mcp",
    "model-context-protocol",
    "mcp-server",
    "ai-memory",
    "coding-agent",
    "persistent-memory",
    "session-continuity",
    "session-memory",
    "agent-memory",
    "llm-memory",
    "ai-agent",
    "llm",
    "multi-agent",
    "agent-coordination",
    "task-tracking",
    "decision-logging",
    "change-tracking",
    "context-persistence",
    "claude",
    "cursor",
    "windsurf",
    "copilot",
    "vscode",
    "sqlite",
    "developer-tools"
  ],
  "author": "Renald Shao (aka Keggan Student) <https://github.com/keggan-std>",
  "homepage": "https://github.com/keggan-std/Engram#readme",
  "license": "MIT",
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.12.0",
    "better-sqlite3": "^12.6.2",
    "zod": "^3.24.0"
  },
  "devDependencies": {
    "@types/better-sqlite3": "^7.6.13",
    "@types/node": "^22.10.0",
    "@vitest/coverage-v8": "^4.0.18",
    "typescript": "^5.7.0",
    "vitest": "^4.0.18"
  },
  "overrides": {
    "prebuild-install": "7.1.3"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
