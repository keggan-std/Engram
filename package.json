{
  "name": "engram-mcp-server",
  "version": "1.4.1",
  "description": "Engram — Persistent Memory Cortex for AI coding agents. Gives agents session continuity, change tracking, decision logging, and project intelligence across sessions.",
  "type": "module",
  "main": "dist/index.js",
  "bin": {
    "engram": "dist/index.js",
    "engram-mcp-server": "dist/index.js"
  },
  "files": [
    "dist/",
    "scripts/"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/keggan-std/Engram"
  },
  "releaseNotes": "# v1.4.0 — Versioned Installs, Auto-Update & Update CLI\n\n**Engram v1.4.0 is live.** This release brings full version awareness to the installer, a background update check service, and user-controlled update management — so agents can keep users informed about new releases without ever interrupting their work.\n\n---\n\n## Breaking Changes\n\nNone. v1.4.0 is fully backwards-compatible. Existing IDE config entries (without `_engram_version`) are automatically adopted on the next `engram install` run.\n\n---\n\n## What's New\n\n### Version-Tracked Installer Entries\n\nEvery IDE config entry written by the installer is now stamped with `_engram_version`. On re-install, the installer detects one of four states and reports it clearly:\n\n| State | Meaning |\n|-------|---------|\n| `added` | Fresh install — no prior entry existed |\n| `exists` | Already installed at this version — nothing written |\n| `upgraded` | Updated from a known older version to the current one |\n| `legacy-upgraded` | Entry existed without a version stamp (pre-v1.4.0) — adopted and stamped |\n\nThe old `\"updated\"` status has been replaced by the more precise `\"upgraded\"` and `\"legacy-upgraded\"` outcomes.\n\n### Background Auto-Update Check\n\nEngram now checks for new versions silently after the MCP server connects. The check is:\n- **Fire-and-forget:** runs via `setImmediate`, never blocks startup or any tool call\n- **Throttled:** runs at most once per 24 hours\n- **Opt-out:** disabled via `engram_config set auto_update_check false`\n- **Snooze-aware:** respects `auto_update_remind_after` (e.g., `7d`, `2w`, `1m`)\n- **Skip-aware:** respects `auto_update_skip_version` to permanently silence a specific version\n- **Level-aware:** `auto_update_notify_level` (`\"major\"` | `\"minor\"` | `\"patch\"`) controls which bump sizes trigger a notification\n\n### Update Notifications via `engram_start_session`\n\nWhen a newer version is available, `engram_start_session` includes an `update_available` field in its response across all three verbosity levels (`minimal`, `summary`, `full`):\n\n```json\n\"update_available\": {\n  \"installed_version\": \"1.3.0\",\n  \"available_version\": \"1.4.0\",\n  \"changelog\": \"### v1.4.0 — ...\",\n  \"releases_url\": \"https://github.com/keggan-std/Engram/releases\"\n}\n```\n\nThe agent presents this to the user, who can respond with any of:\n- **Update** → agent tells user to run `npx -y engram-mcp-server install`\n- **Skip this version** → `engram_config set auto_update_skip_version 1.4.0`\n- **Postpone** → `engram_config set auto_update_remind_after 7d`\n- **Disable checks** → `engram_config set auto_update_check false`\n\n### Two-Source Changelog Delivery\n\nUpdate notifications include the release changelog fetched from:\n1. **npm registry** (`https://registry.npmjs.org/engram-mcp-server/latest`) — includes the `releaseNotes` field injected at publish time by the new pre-publish script\n2. **GitHub Releases API** — fallback when the registry is unreachable or `releaseNotes` is absent\n\nBoth sources use a 5-second timeout. Network failures are silent — startup is never affected.\n\n### New `--check` CLI Flag\n\n```bash\nnpx -y engram-mcp-server install --check\n```\n\nShows the installed version for every detected IDE, fetches the npm latest, and correctly handles three scenarios:\n\n| Scenario | Label |\n|----------|-------|\n| Running == npm latest | `✅ up to date` |\n| Running > npm latest | `⚡ running pre-release (vX.Y.Z > npm vA.B.C)` |\n| Running < npm latest | `⬆  npm has vX.Y.Z — run: npx -y engram-mcp-server install` |\n\n### `engram_stats` — Version & Update Status\n\n`engram_stats` now returns:\n\n```json\n{\n  \"server_version\": \"1.4.0\",\n  \"update_status\": { \"available\": true, \"version\": \"1.5.0\", \"releases_url\": \"...\" },\n  \"auto_update_check\": \"enabled\",\n  \"last_update_check\": \"2026-02-23T00:00:00.000Z\"\n}\n```\n\n### `engram_config` — New Update Keys\n\nFour new keys are now accepted by `engram_config`:\n\n| Key | Type | Description |\n|-----|------|-------------|\n| `auto_update_check` | `true`/`false` | Enable/disable background update checks |\n| `auto_update_skip_version` | string | Version to permanently silence (e.g., `1.4.1`) |\n| `auto_update_remind_after` | duration or ISO date | Snooze updates (`7d`, `2w`, `1m`, or ISO string) |\n| `auto_update_notify_level` | `major`/`minor`/`patch` | Minimum bump size to trigger a notification |\n\n### Pre-publish Release Notes Injection\n\nA new `scripts/inject-release-notes.js` script runs automatically before every `npm publish` (as part of the `prepack` lifecycle). It reads `RELEASE_NOTES.md`, extracts the current version's section, and writes it into `package.json` as `releaseNotes`. This allows the update service to deliver changelogs in a single HTTP call to the npm registry — no CDN dependency, no GitHub rate limits.\n\n---\n\n## Fixes & Internal\n\n- Removed duplicate `getVersion()` function from `src/installer/index.ts` — now uses `getInstallerVersion()` from `config-writer.ts` as single source of truth\n- `UpdateService` uses only built-in Node.js 18+ `fetch` — no new runtime dependencies added\n- `addToConfig()` now uses version-first comparison instead of full JSON deep-equal, making the comparison logic explicit and testable\n\n---\n\n**Full Changelog**: https://github.com/keggan-std/Engram/compare/v1.3.0...v1.4.0\n\n---",
  "scripts": {
    "build": "tsc",
    "prepack": "node scripts/inject-release-notes.js && npm run clean && npm run build",
    "test": "vitest run",
    "test:watch": "vitest",
    "start": "node dist/index.js",
    "dev": "tsc --watch",
    "clean": "node -e \"const {rmSync,existsSync}=require('fs');if(existsSync('dist'))rmSync('dist',{recursive:true,force:true})\"",
    "install-hooks": "node dist/scripts/install-hooks.js",
    "install-mcp": "node scripts/install-mcp.js",
    "install-mcp:list": "node scripts/install-mcp.js --list",
    "inspect": "npx @modelcontextprotocol/inspector node dist/index.js"
  },
  "keywords": [
    "mcp",
    "model-context-protocol",
    "ai-memory",
    "coding-agent",
    "persistent-memory",
    "session-continuity"
  ],
  "author": "",
  "license": "MIT",
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.12.0",
    "better-sqlite3": "^12.6.2",
    "zod": "^3.24.0"
  },
  "devDependencies": {
    "@types/better-sqlite3": "^7.6.13",
    "@types/node": "^22.10.0",
    "typescript": "^5.7.0",
    "vitest": "^4.0.18"
  },
  "overrides": {
    "prebuild-install": "7.1.3"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
